{"ast":null,"code":"import _regeneratorRuntime from\"/Users/leesebastian/Desktop/whitetails/Farnhok/skoolsCapstone/frontend/skools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/leesebastian/Desktop/whitetails/Farnhok/skoolsCapstone/frontend/skools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"/Users/leesebastian/Desktop/whitetails/Farnhok/skoolsCapstone/frontend/skools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/Users/leesebastian/Desktop/whitetails/Farnhok/skoolsCapstone/frontend/skools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/leesebastian/Desktop/whitetails/Farnhok/skoolsCapstone/frontend/skools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Users/leesebastian/Desktop/whitetails/Farnhok/skoolsCapstone/frontend/skools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/leesebastian/Desktop/whitetails/Farnhok/skoolsCapstone/frontend/skools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/leesebastian/Desktop/whitetails/Farnhok/skoolsCapstone/frontend/skools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import axios from'axios';import React,{Component}from'react';import{storage}from'../../firebase';import{Input,Button,Progress}from'reactstrap';import{connect}from'react-redux';import{uploadMedia as _uploadMedia}from'../../redux/cmsDetails/action';import'./../../../src/assets/css/cms/cmsDetails.css';var PureUploader=/*#__PURE__*/function(_Component){_inherits(PureUploader,_Component);var _super=_createSuper(PureUploader);function PureUploader(props){var _this;_classCallCheck(this,PureUploader);_this=_super.call(this,props);_this.handleInput=function(e){_this.setState(_defineProperty({},e.target.name,e.target.value));};_this.handleChange=function(e){var file=e.target.files[0];console.log(file);_this.setState({image:file});};_this.handleUpload=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var image,uploaderName,caption,uploadTask;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:image=_this.state.image;uploaderName=e.target.name;caption=_this.state.caption;console.log(e.target.name,_this.state.caption);if((uploaderName==='teacher'||uploaderName==='facility')&&caption===null){_this.setState({errMsg:'Do not leave caption/description blank'});}else{uploadTask=storage.ref(\"image/\".concat(image.name)).put(image);uploadTask.on('state_changed',function(snapshot){console.log('snapshot');var progress=Math.round(snapshot.bytesTransferred/snapshot.totalBytes*100);_this.setState({progress:progress});}//progress function .....\n,function(error){//error function\nconsole.log(error);},function(){storage.ref('image').child(image.name).getDownloadURL().then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(url){var photoOptions,teacherPhoto,_photoOptions,facilityPhoto;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(uploaderName==='teacher')){_context.next=8;break;}console.log('uploading teacher');photoOptions={method:'POST',url:\"http://localhost:8080/school/\",data:{url:url,caption:caption,photo_category:'teacher'},headers:{'Authorization':'Bearer '+localStorage.getItem('cmsToken')}};_context.next=5;return axios(photoOptions);case 5:teacherPhoto=_context.sent;_context.next=14;break;case 8:if(!(uploaderName==='facility')){_context.next=14;break;}console.log('uploading facility');_photoOptions={method:'POST',url:\"http://localhost:8080/school/\",data:{url:url,caption:caption,photo_category:'facility'},headers:{'Authorization':'Bearer '+localStorage.getItem('cmsToken')}};_context.next=13;return axios(_photoOptions);case 13:facilityPhoto=_context.sent;case 14:_this.props.uploadMedia(url,caption,uploaderName);case 15:case\"end\":return _context.stop();}}},_callee);}));return function(_x2){return _ref2.apply(this,arguments);};}());// define image name\n});};case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref.apply(this,arguments);};}();_this.clearInput=function(e){e.preventDefault();_this.setState({image:'',caption:'',progress:0});};_this.state={image:'',progress:0,caption:null,errMsg:''};_this.handleChange=_this.handleChange.bind(_assertThisInitialized(_this));_this.handleUpload=_this.handleUpload.bind(_assertThisInitialized(_this));_this.handleInput=_this.handleInput.bind(_assertThisInitialized(_this));_this.clearInput=_this.clearInput.bind(_assertThisInitialized(_this));return _this;}_createClass(PureUploader,[{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/React.createElement(\"div\",{style:this.props.style},/*#__PURE__*/React.createElement(\"h1\",null,this.props.text),/*#__PURE__*/React.createElement(\"div\",{className:\"uploadBar\"},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Input,{type:\"file\",onChange:function onChange(e){return _this2.handleChange(e);}})),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Input,{id:\"captionInput\",className:this.props.hasCaption,type:\"textarea\",name:\"caption\",placeholder:\"Caption/Description\",value:this.state.caption,onChange:this.handleInput})),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Button,{name:this.props.uploaderName,onClick:this.handleUpload},\"Upload\"),/*#__PURE__*/React.createElement(\"br\",null))),/*#__PURE__*/React.createElement(\"div\",{className:\"progressBar\"},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Progress,{bar:true,value:this.state.progress,max:\"100\"},\" LOADING \"),/*#__PURE__*/React.createElement(\"br\",null)),/*#__PURE__*/React.createElement(\"div\",null,this.state.errMsg),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Button,{className:this.props.hasClear,color:\"primary\",onClick:this.clearInput},\"Add Another\"))));}}]);return PureUploader;}(Component);var mapDispatchToProps=function mapDispatchToProps(dispatch){return{uploadMedia:function uploadMedia(url,caption,uploaderName){dispatch(_uploadMedia(url,caption,uploaderName));}};};export var Uploader=connect(null,mapDispatchToProps)(PureUploader);","map":{"version":3,"sources":["/Users/leesebastian/Desktop/whitetails/Farnhok/skoolsCapstone/frontend/skools/src/component/schoolCms/singleUploader.jsx"],"names":["axios","React","Component","storage","Input","Button","Progress","connect","uploadMedia","PureUploader","props","handleInput","e","setState","target","name","value","handleChange","file","files","console","log","image","handleUpload","state","uploaderName","caption","errMsg","uploadTask","ref","put","on","snapshot","progress","Math","round","bytesTransferred","totalBytes","error","child","getDownloadURL","then","url","photoOptions","method","data","photo_category","headers","localStorage","getItem","teacherPhoto","facilityPhoto","clearInput","preventDefault","bind","style","text","hasCaption","hasClear","mapDispatchToProps","dispatch","Uploader"],"mappings":"+hDAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,KAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CACA,OAASC,OAAT,KAAwB,gBAAxB,CACA,OAAQC,KAAR,CAAeC,MAAf,CAAuBC,QAAvB,KAAsC,YAAtC,CACA,OAASC,OAAT,KAAwB,aAAxB,CACA,OAAQC,WAAW,GAAXA,CAAAA,YAAR,KAA0B,+BAA1B,CACA,MAAO,8CAAP,C,GAEMC,CAAAA,Y,4GACH,sBAAYC,KAAZ,CAAmB,8CACf,uBAAMA,KAAN,EADe,MAgBnBC,WAhBmB,CAgBL,SAAAC,CAAC,CAAI,CAClB,MAAKC,QAAL,oBACKD,CAAC,CAACE,MAAF,CAASC,IADd,CACqBH,CAAC,CAACE,MAAF,CAASE,KAD9B,GAGH,CApBqB,OAuBnBC,YAvBmB,CAuBJ,SAAAL,CAAC,CAAI,CAChB,GAAIM,CAAAA,IAAI,CAAGN,CAAC,CAACE,MAAF,CAASK,KAAT,CAAe,CAAf,CAAX,CACAC,OAAO,CAACC,GAAR,CAAYH,IAAZ,EACI,MAAKL,QAAL,CACI,CAACS,KAAK,CAACJ,IAAP,CADJ,EAGH,CA7Bc,OAgClBK,YAhCkB,0FAgCH,kBAAOX,CAAP,gKACHU,KADG,CACO,MAAKE,KADZ,CACHF,KADG,CAEPG,YAFO,CAEQb,CAAC,CAACE,MAAF,CAASC,IAFjB,CAGPW,OAHO,CAGG,MAAKF,KAAL,CAAWE,OAHd,CAIjBN,OAAO,CAACC,GAAR,CAAaT,CAAC,CAACE,MAAF,CAASC,IAAtB,CAA4B,MAAKS,KAAL,CAAWE,OAAvC,EAEM,GAAG,CAACD,YAAY,GAAK,SAAjB,EAA8BA,YAAY,GAAK,UAAhD,GAA+DC,OAAO,GAAK,IAA9E,CAAmF,CAC/E,MAAKb,QAAL,CAAc,CAACc,MAAM,CAAC,wCAAR,CAAd,EACH,CAFD,IAEO,CAECC,UAFD,CAEczB,OAAO,CAAC0B,GAAR,iBAAqBP,KAAK,CAACP,IAA3B,GAAmCe,GAAnC,CAAuCR,KAAvC,CAFd,CAIHM,UAAU,CAACG,EAAX,CAAc,eAAd,CACI,SAACC,QAAD,CAAc,CACVZ,OAAO,CAACC,GAAR,CAAY,UAAZ,EACA,GAAMY,CAAAA,QAAQ,CAAGC,IAAI,CAACC,KAAL,CAAYH,QAAQ,CAACI,gBAAT,CAA4BJ,QAAQ,CAACK,UAAtC,CAAoD,GAA/D,CAAjB,CACA,MAAKxB,QAAL,CAAc,CAAEoB,QAAQ,CAARA,QAAF,CAAd,EACH,CAAC;AALN,CAMM,SAACK,KAAD,CAAW,CAAE;AACXlB,OAAO,CAACC,GAAR,CAAYiB,KAAZ,EACH,CARL,CAQO,UAAM,CACLnC,OAAO,CAAC0B,GAAR,CAAY,OAAZ,EAAqBU,KAArB,CAA2BjB,KAAK,CAACP,IAAjC,EAAuCyB,cAAvC,GAAwDC,IAAxD,2FACI,iBAAOC,GAAP,iLAEGjB,YAAY,GAAG,SAFlB,0BAGIL,OAAO,CAACC,GAAR,CAAY,mBAAZ,EACIsB,YAJR,CAIuB,CACfC,MAAM,CAAE,MADO,CAEfF,GAAG,gCAFY,CAGfG,IAAI,CAAE,CAACH,GAAG,CAAEA,GAAN,CAAWhB,OAAO,CAACA,OAAnB,CAA4BoB,cAAc,CAAC,SAA3C,CAHS,CAIfC,OAAO,CAAE,CACL,gBAAiB,UAAYC,YAAY,CAACC,OAAb,CAAqB,UAArB,CADxB,CAJM,CAJvB,uBAY4BjD,CAAAA,KAAK,CAAC2C,YAAD,CAZjC,QAYOO,YAZP,kDAgBQzB,YAAY,GAAK,UAhBzB,2BAkBIL,OAAO,CAACC,GAAR,CAAY,oBAAZ,EACIsB,aAnBR,CAmBuB,CACfC,MAAM,CAAE,MADO,CAEfF,GAAG,gCAFY,CAGfG,IAAI,CAAE,CAACH,GAAG,CAAEA,GAAN,CAAWhB,OAAO,CAACA,OAAnB,CAA4BoB,cAAc,CAAC,UAA3C,CAHS,CAIfC,OAAO,CAAE,CACL,gBAAiB,UAAYC,YAAY,CAACC,OAAb,CAAqB,UAArB,CADxB,CAJM,CAnBvB,wBA2B8BjD,CAAAA,KAAK,CAAC2C,aAAD,CA3BnC,SA2BQQ,aA3BR,uBA+BA,MAAKzC,KAAL,CAAWF,WAAX,CAAuBkC,GAAvB,CAA4BhB,OAA5B,CAAqCD,YAArC,EA/BA,uDADJ,kEAmCO;AACN,CA7CT,EAgDC,EA5DM,wDAhCG,qEA+FlB2B,UA/FkB,CA+FL,SAAAxC,CAAC,CAAI,CACdA,CAAC,CAACyC,cAAF,GACA,MAAKxC,QAAL,CAAc,CACVS,KAAK,CAAC,EADI,CAEVI,OAAO,CAAE,EAFC,CAGVO,QAAQ,CAAC,CAHC,CAAd,EAKH,CAtGiB,CAEf,MAAKT,KAAL,CAAa,CACTF,KAAK,CAAE,EADE,CAETW,QAAQ,CAAE,CAFD,CAGTP,OAAO,CAAE,IAHA,CAITC,MAAM,CAAE,EAJC,CAAb,CAOA,MAAKV,YAAL,CAAoB,MAAKA,YAAL,CAAkBqC,IAAlB,+BAApB,CACA,MAAK/B,YAAL,CAAoB,MAAKA,YAAL,CAAkB+B,IAAlB,+BAApB,CACA,MAAK3C,WAAL,CAAmB,MAAKA,WAAL,CAAiB2C,IAAjB,+BAAnB,CACA,MAAKF,UAAL,CAAkB,MAAKA,UAAL,CAAgBE,IAAhB,+BAAlB,CAZe,aAalB,C,gEA4FQ,iBAEJ,mBACI,2BAAK,KAAK,CAAE,KAAK5C,KAAL,CAAW6C,KAAvB,eACI,8BAAK,KAAK7C,KAAL,CAAW8C,IAAhB,CADJ,cAEI,2BAAK,SAAS,CAAC,WAAf,eACI,4CACI,oBAAC,KAAD,EAAO,IAAI,CAAC,MAAZ,CAAmB,QAAQ,CAAE,kBAAA5C,CAAC,QAAI,CAAA,MAAI,CAACK,YAAL,CAAkBL,CAAlB,CAAJ,EAA9B,EADJ,CADJ,cAII,4CACI,oBAAC,KAAD,EAAO,EAAE,CAAC,cAAV,CACA,SAAS,CAAE,KAAKF,KAAL,CAAW+C,UADtB,CAEA,IAAI,CAAC,UAFL,CAGA,IAAI,CAAC,SAHL,CAIA,WAAW,CAAC,qBAJZ,CAKA,KAAK,CAAE,KAAKjC,KAAL,CAAWE,OALlB,CAMA,QAAQ,CAAE,KAAKf,WANf,EADJ,CAJJ,cAcI,4CACI,oBAAC,MAAD,EAAQ,IAAI,CAAE,KAAKD,KAAL,CAAWe,YAAzB,CAAuC,OAAO,CAAE,KAAKF,YAArD,WADJ,cAEI,8BAFJ,CAdJ,CAFJ,cAqBI,2BAAK,SAAS,CAAC,aAAf,eACI,4CACI,oBAAC,QAAD,EAAU,GAAG,KAAb,CAAc,KAAK,CAAE,KAAKC,KAAL,CAAWS,QAAhC,CAA0C,GAAG,CAAC,KAA9C,cADJ,cAEI,8BAFJ,CADJ,cAKI,+BAAM,KAAKT,KAAL,CAAWG,MAAjB,CALJ,cAMI,4CACI,oBAAC,MAAD,EAAQ,SAAS,CAAE,KAAKjB,KAAL,CAAWgD,QAA9B,CAAwC,KAAK,CAAC,SAA9C,CAAwD,OAAO,CAAE,KAAKN,UAAtE,gBADJ,CANJ,CArBJ,CADJ,CAoCH,C,0BAhJsBlD,S,EAoJ3B,GAAMyD,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,CAACC,QAAD,CAAc,CACrC,MAAO,CACHpD,WAAW,CAAE,qBAACkC,GAAD,CAAMhB,OAAN,CAAeD,YAAf,CAAgC,CACzCmC,QAAQ,CAACpD,YAAW,CAACkC,GAAD,CAAMhB,OAAN,CAAeD,YAAf,CAAZ,CAAR,CACN,CAHK,CAAP,CAKH,CAND,CAOA,MAAO,IAAMoC,CAAAA,QAAQ,CAAGtD,OAAO,CAAC,IAAD,CAAOoD,kBAAP,CAAP,CAAkClD,YAAlC,CAAjB","sourcesContent":["import axios from 'axios';\r\nimport React, { Component } from 'react';\r\nimport { storage } from '../../firebase';\r\nimport {Input, Button, Progress} from 'reactstrap';\r\nimport { connect } from 'react-redux';\r\nimport {uploadMedia} from '../../redux/cmsDetails/action'\r\nimport './../../../src/assets/css/cms/cmsDetails.css';\r\n\r\nclass PureUploader extends Component {\r\n   constructor(props) {\r\n       super(props);\r\n       this.state = {\r\n           image: '',\r\n           progress: 0,\r\n           caption: null,\r\n           errMsg: ''\r\n       }\r\n\r\n       this.handleChange = this.handleChange.bind(this);\r\n       this.handleUpload = this.handleUpload.bind(this);\r\n       this.handleInput = this.handleInput.bind(this);\r\n       this.clearInput = this.clearInput.bind(this)\r\n   }\r\n\r\n\r\n   handleInput = e => {\r\n    this.setState({\r\n        [e.target.name]: e.target.value,\r\n    })\r\n}\r\n\r\n\r\n   handleChange = e => {\r\n       let file = e.target.files[0];\r\n       console.log(file)\r\n           this.setState(\r\n               {image:file});\r\n\r\n       }\r\n   \r\n\r\n    handleUpload = async (e) => {\r\n        const { image } = this.state;\r\n        let uploaderName = e.target.name;\r\n        let caption = this.state.caption;\r\n  console.log( e.target.name, this.state.caption)\r\n\r\n        if((uploaderName === 'teacher' || uploaderName === 'facility') && caption === null){\r\n            this.setState({errMsg:'Do not leave caption/description blank'})\r\n        } else {\r\n\r\n            let uploadTask = storage.ref(`image/${image.name}`).put(image);\r\n\r\n            uploadTask.on('state_changed',\r\n                (snapshot) => {\r\n                    console.log('snapshot')\r\n                    const progress = Math.round((snapshot.bytesTransferred / snapshot.totalBytes) * 100);\r\n                    this.setState({ progress })\r\n                } //progress function .....\r\n                , (error) => { //error function\r\n                    console.log(error);\r\n                }, () => {\r\n                    storage.ref('image').child(image.name).getDownloadURL().then(\r\n                        async (url) => {\r\n                        \r\n                        if(uploaderName==='teacher'){\r\n                            console.log('uploading teacher')\r\n                            let photoOptions = {\r\n                                method: 'POST',\r\n                                url: `http://localhost:8080/school/`,\r\n                                data: {url: url, caption:caption, photo_category:'teacher'},\r\n                                headers: {\r\n                                    'Authorization': 'Bearer ' + localStorage.getItem('cmsToken')\r\n                                    }\r\n                                }\r\n                           let teacherPhoto = await axios(photoOptions) \r\n                        }\r\n                            \r\n                        \r\n                        else if(uploaderName === 'facility'){\r\n\r\n                            console.log('uploading facility')\r\n                            let photoOptions = {\r\n                                method: 'POST',\r\n                                url: `http://localhost:8080/school/`,\r\n                                data: {url: url, caption:caption, photo_category:'facility'},\r\n                                headers: {\r\n                                    'Authorization': 'Bearer ' + localStorage.getItem('cmsToken')\r\n                                }\r\n                            }\r\n                            let facilityPhoto = await axios(photoOptions)\r\n\r\n                        }    \r\n\r\n                        this.props.uploadMedia(url, caption, uploaderName)\r\n                        }\r\n\r\n                        )  // define image name\r\n                    })\r\n                \r\n            \r\n            };\r\n        }\r\n    \r\n    clearInput = e => {\r\n        e.preventDefault();\r\n        this.setState({\r\n            image:'',\r\n            caption: '',\r\n            progress:0\r\n        })\r\n    }\r\n\r\n\r\n   render() {\r\n\r\n        return (\r\n            <div style={this.props.style}>\r\n                <h1>{this.props.text}</h1>\r\n                <div className='uploadBar'>\r\n                    <div>\r\n                        <Input type='file' onChange={e => this.handleChange(e)} />\r\n                    </div>\r\n                    <div >\r\n                        <Input id='captionInput'\r\n                        className={this.props.hasCaption}\r\n                        type='textarea' \r\n                        name='caption' \r\n                        placeholder='Caption/Description' \r\n                        value={this.state.caption} \r\n                        onChange={this.handleInput}/>\r\n                    </div>\r\n                    \r\n                    <div>\r\n                        <Button name={this.props.uploaderName} onClick={this.handleUpload}>Upload</Button>\r\n                        <br />\r\n                    </div>\r\n                </div>\r\n                <div className='progressBar'>\r\n                    <div>\r\n                        <Progress bar value={this.state.progress} max='100'> LOADING </Progress>\r\n                        <br/>\r\n                    </div>\r\n                    <div>{this.state.errMsg}</div>\r\n                    <div>\r\n                        <Button className={this.props.hasClear} color='primary' onClick={this.clearInput}>Add Another</Button>\r\n                    </div>\r\n                </div>\r\n                    \r\n                \r\n            </div>\r\n        )\r\n    }\r\n\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch) => {\r\n    return {\r\n        uploadMedia: (url, caption, uploaderName) => {\r\n            dispatch(uploadMedia(url, caption, uploaderName))\r\n     }\r\n}\r\n}\r\nexport const Uploader = connect(null, mapDispatchToProps)(PureUploader);\r\n"]},"metadata":{},"sourceType":"module"}